---
name: ai-video-script
description: AI视频带货脚本生成器。当用户提供产品图片和/或产品描述，要求生成AI视频营销脚本、带货视频脚本、社交媒体短视频脚本时使用。输出4分镜脚本规划、Nano Banana生图提示词（首尾帧）、Veo3生视频提示词，保持人物/场景/音色一致性。支持迭代优化。
---

# AI视频带货脚本生成器

## 工作流程

### Step 1: 收集信息
向用户确认以下信息（如未提供）：
1. **产品图片**（必须）- 用于理解产品外观
2. **产品描述**（必须）- 产品名称、核心卖点、目标受众
3. **场景偏好**（可选）- 拍摄场景（卧室、厨房、办公室、户外等）
4. **人物设定**（可选）- 性别、年龄、风格（默认：年轻女性，25-30岁）
5. **目标平台**（可选）- 抖音/小红书/TikTok等
6. **视频风格**（可选）- 真实生活感/专业测评/闺蜜分享等
7. **转身需求**（服装类必问）- 是否需要展示正反两面图案。服装正面和背面图案可能不同，需提前确认以设计首尾帧朝向

### Step 1.5: 产品图预处理
先询问用户提供的图片类型，然后走不同分支：

**情况A：用户已有白底产品图**
直接拼接即可使用：
```bash
python scripts/generate_images.py --mode composite --product-images "图1路径,图2路径" --output output/images
```
- 多张图横向拼接为一张 → `output/images/product_composite.png`
- 单张图直接复制 → `output/images/product_composite.png`

**情况B：用户只有实拍图/模特图（无白底图）**
需要用Nano Banana Pro从实拍图中提炼产品白底图：
```bash
python scripts/generate_images.py --mode extract-product --product-images "实拍图1,实拍图2" --output output/images [--with-back]
```
- 将所有实拍图作为reference传入，用提示词要求提炼出产品的纯白背景标准图
- 正面 → `output/images/product_front.png`
- 背面（如需要）→ `output/images/product_back.png`
- 最后将正面（+背面）拼接为 → `output/images/product_composite.png`
- 展示给用户确认产品提炼效果，确认后继续

提炼提示词模板见 `references/prompt-templates.md`。

**后续所有包含产品的首尾帧生图时，都将 `product_composite.png` 作为额外reference传入，确保产品外观一致。**

### Step 2: 脚本规划（拉片）
分析产品，设计4分镜视频脚本。

**默认结构：**

| 分镜 | 类型 | 镜头 | 说明 |
|------|------|------|------|
| 1 | 人物口播（Hook） | 中近景，人物+产品/场景同框 | 吸引注意力，引出话题 |
| 2 | 产品/场景展示 | 产品全景或使用场景 | 展示产品整体或使用环境 |
| 3 | 产品细节/卖点 | 特写或近距离 | 聚焦核心卖点、材质、细节 |
| 4 | 人物口播（CTA） | 近景，人物贴近镜头 | 总结感受+引导行动 |

**原则：**
- **每段视频固定8秒**（Veo 3.1生成时长）：口播文案+动作必须填满8秒，不能太短导致后几秒无声沉闷，也不能太长导致话没说完就截断。设计口播时按正常语速朗读测试，确保约8秒讲完。首尾帧的动作设计也要覆盖8秒的动作量。
- **4个分镜必须有镜头变化**：不能所有分镜都是同一机位/同一景别/同一构图。要在以下维度做切换：
  - **机位角度**：自拍斜角 / 正面平视 / 俯拍 / 侧面等
  - **景别**：近景 / 中景 / 全景 / 特写
  - **人物是否出镜**：部分分镜人物出镜口播，部分分镜人物不出镜只拍产品（手可入画）
  - **示例**：分镜1人物出镜自拍口播 → 分镜2人物不出镜俯拍产品平铺/手持展示 → 分镜3正面全身穿搭展示 → 分镜4近景人物口播CTA
  - 穿戴类产品：可从「穿在身上口播」切换到「产品平铺/脱下展示」；手持类产品：可从「人物手持」切换到「产品单独特写」
- 每段视频独立，不依赖前后段的首尾帧衔接
- 口播自然口语化，像跟朋友聊天
- Hook前3秒抓注意力
- **服装类首帧正面约束**：服装类目的所有首帧，人物/产品必须正面朝向镜头（不可侧身）。因为Veo生视频阶段只传入首尾帧图片，不传产品原图，侧身会导致AI自行幻想图案内容，造成不真实。尾帧暂不做此限制。穿着状态和产品平铺状态都要正面朝向。
- **服装类转身设计**：如果用户确认需要展示正反两面图案，则首帧设计为一面（如正面穿着），尾帧设计为另一面（如背面穿着），让AI在视频生成时能通过首尾帧看到两面的真实图案。不需要转身则首尾帧保持同一朝向。

每个分镜输出：镜头描述（含机位/景别/人物是否出镜）、画面内容、口播文案（需适配8秒）、动作流程。

**等用户确认脚本后再进入下一步。**

### Step 2.5: 生成角色参考图
脚本确认后，在生成8张首尾帧之前，先生成一张**白底角色参考图**，用于锁定人物外貌：

1. 根据模块A的人物描述，生成一张白色纯净背景的角色半身照
2. 提示词只包含人物外貌描述 + "纯白色背景 半身照 正面面朝镜头 表情自然"
3. 保存为 `output/images/character_ref.png`
4. 展示给用户确认人物形象，确认后继续

**此角色参考图将作为所有后续生图的reference image传入，确保人物面孔一致。**

### Step 3: 生图提示词（Nano Banana首尾帧）
为每个分镜生成首帧+尾帧图片提示词（共8张）。

详细提示词模板框架见 `references/prompt-templates.md`。

**核心规则：**
- 每张图必须包含完整的人物描述块（模块A）、场景描述块（模块B）、反AI标签块（模块C）、分镜专属内容（模块D）
- 人物描述和场景描述在所有图中一字不改地复制
- 首帧=动作起始状态，尾帧=动作结束状态
- 每段首尾帧完全独立，不与相邻段共享
- **角色参考图机制**：所有图生成时都传入角色参考图（character_ref.png）作为reference，确保人物面孔一致
- **首帧锚定尾帧**：同一分镜内先生成首帧，再把首帧作为额外reference传入生成尾帧，确保背景场景一致。尾帧提示词中需增加"背景场景严格参考首帧图片，保持建筑、道具、光影细节一致"
- **服装类首帧正面强制**：服装类目中，所有包含产品的首帧，人物/产品必须正面面对镜头，禁止侧身角度，确保产品图案在首帧中完整可见。Veo生视频时不传产品原图，首帧侧身会导致AI幻想图案

### Step 3.5: 自动生成首尾帧图片
提示词确认后，询问用户是否自动调用API生成图片。如果用户确认：

1. 将提示词保存为JSON文件（`output/image_prompts.json`），结构如下：
```json
{
  "character_prompt": "白底角色参考图提示词...",
  "scenes": [
    {
      "scene": 1,
      "first": {"name": "scene1_first", "prompt": "首帧提示词..."},
      "last": {"name": "scene1_last", "prompt": "尾帧提示词...（含场景锚定描述）"}
    }
  ]
}
```
2. 运行生图脚本：
```bash
python scripts/generate_images.py --prompts output/image_prompts.json --output output/images
```
3. 脚本使用 Nano Banana Pro (`gemini-3-pro-image-preview`)，生成流程：
   - **第一步**：生成角色参考图（白底半身照）→ 保存为 `character_ref.png`
   - **第二步**：逐分镜串行生成首帧和尾帧：
     - 首帧：contents = [角色参考图, 产品白底图, 提示词]
     - 尾帧：contents = [角色参考图, 产品白底图, 首帧图, 提示词]（首帧作为场景锚定参考）
   - 产品白底图根据分镜内容选择正面或背面图传入
4. 输出文件：`character_ref.png`, `scene1_first.png`, `scene1_last.png`... 共9张

### Step 4: 生视频提示词（Veo3）
为每段视频生成Veo3提示词。

详细提示词模板框架见 `references/prompt-templates.md`。

**核心规则：**
- 每段包含：场景人物一致性声明 + 动作画面描述 + 口播内容与音色控制 + 反AI标签
- 人物描述与生图提示词完全一致
- **音色描述在4段视频中完全相同**（语气、语速、情绪、声线特征）
- 每段口播文案必须同步出现在视频中

### Step 4.X: Director Review（导演审核）
在调用API生成图片/视频之前，以导演视角审核 `image_prompts.json` 和 `video_prompts.json`，检查潜在问题。

**审核清单：**

| 检查项 | 说明 | 常见问题 |
|--------|------|----------|
| **POV视角一致性** | 自拍镜头必须用POV视角描述，不能出现"手持手机"等第三人视角描述 | 描述"手拿手机自拍"导致AI生成第三人视角画面 |
| **首尾帧动作连贯性** | 同一分镜的首帧道具/手势不能与尾帧动作冲突 | 首帧手持咖啡，尾帧又要用同一只手拉领子 |
| **图片/视频提示词同步** | 同一分镜的图片提示词和视频提示词核心元素（道具、动作、场景）必须一致 | 改了图片提示词，忘改视频提示词 |
| **音色描述一致性** | 4段视频的音色描述块必须字面完全相同 | 每段用不同的Pace/Mood描述导致音色不一致 |
| **服装类首帧正面约束** | 服装类首帧人物/产品必须正面朝镜头，不可侧身 | 侧身导致Veo幻想产品图案 |
| **8秒时长匹配** | 朗读口播文案+预估动作是否约8秒 | 文案太短导致后几秒沉默，或太长被截断 |
| **道具/场景合理性** | 检查道具组合、场景描述是否自然合理 | 不合理的道具组合让画面显得假 |

**审核流程：**
1. 逐条检查上述清单
2. 输出审核报告：
   - ✓ 检查通过的项目
   - ⚠ 发现的问题及修复建议
3. 如有问题，修正后重新审核
4. 用户确认无问题后，进入生成步骤

**审核报告模板：**
```
## Director Review 审核报告

### 检查通过 ✓
- POV视角一致性：所有自拍镜头使用POV描述
- 音色描述一致性：4段视频音色块相同
- ...

### 发现问题 ⚠
1. [分镜1] 首尾帧动作矛盾：首帧手持咖啡，尾帧需要用手拉领子
   → 建议：移除咖啡元素，或改为放在桌上
2. [分镜2] 图片/视频提示词不同步：图片已删除咖啡，视频仍提及
   → 建议：同步删除视频提示词中的咖啡描述

### 确认
- 请确认修正后继续生成
```

### Step 4.5: 自动生成视频
视频提示词确认后，询问用户是否自动调用API生成视频。如果用户确认：

1. 将4个视频提示词保存为JSON文件（`output/video_prompts.json`）
2. 运行生视频脚本：
```bash
python scripts/generate_videos.py --prompts output/video_prompts.json --images output/images --output output/videos
```
3. 脚本使用 Veo 3.1 Fast (`veo-3.1-fast-generate-preview`) 逐段生成
4. 每段视频使用对应的首帧+尾帧图片
5. 生成为异步操作，脚本会自动轮询等待完成
6. 输出文件：`video1.mp4`, `video2.mp4`, `video3.mp4`, `video4.mp4`
7. 所有分段视频生成完成后，脚本自动按顺序拼接为 `final.mp4`（使用 ffmpeg concat，优先 stream copy，失败则 re-encode）

JSON格式：
```json
[
  {"name": "video1", "prompt": "完整提示词...", "first_frame": "scene1_first.png", "last_frame": "scene1_last.png"}
]
```

### Step 5: 迭代优化
输出完成后询问用户反馈，修改对应部分。将有价值的偏好记录到本文件底部「用户偏好记录」区域。

## 输出目录结构

每次使用 skill 会自动创建递增命名的输出目录，格式为 `YYYYMMDD_NNN`：

```
output/
├── 20260203_001/          # 第一次运行
│   ├── images/
│   │   ├── character_ref.png
│   │   ├── product_composite.png
│   │   ├── scene1_first.png
│   │   └── ...
│   └── videos/
│       ├── video1.mp4
│       └── final.mp4
├── 20260203_002/          # 同日第二次运行
│   ├── images/
│   └── videos/
└── latest_run.txt         # 记录最新 run 目录路径
```

- 每次运行自动创建新目录，不覆盖历史记录
- `latest_run.txt` 用于视频脚本定位当前 run 的图片目录
- 可手动清理旧目录释放空间

## 环境要求
- Python 3.9+
- `pip install google-genai Pillow python-dotenv`
- ffmpeg（用于视频拼接，需在系统 PATH 中可用）
- 项目根目录 `.env` 文件中设置 `GEMINI_API_KEY`

## 关键约束

1. **人物描述一致性**：所有提示词中人物外貌描述使用完全相同的文字块
2. **角色参考图机制**：生图前先生成白底角色参考图，后续所有图都传入该参考图作为reference，从图片层面锁定人物面孔
3. **首帧锚定尾帧**：同一分镜先生成首帧，尾帧生成时传入首帧作为额外reference，确保背景场景一致
4. **场景描述一致性**：基础场景设定在所有提示词中保持一致
5. **音色描述一致性**：4段Veo3视频的音色/语气描述完全相同
6. **写实约束**：每段提示词都包含反AI感约束标签
7. **首尾帧独立**：每段视频首尾帧不依赖其他段
8. **口播口语化**：文案自然口语，像真人聊天
9. **分步输出**：先脚本规划→用户确认→再生图+生视频提示词
10. **Director Review**：生成前必须执行导演审核，检查POV视角、首尾帧动作连贯性、图片/视频提示词同步、音色一致性等

## 产品类型参考

### 服装类（T恤、外套等）
**特殊约束**：首帧必须正面朝镜头，禁止侧身。需提前确认是否展示正反面。
- 无转身：1. 人物正面穿着口播Hook → 2. 产品正面平铺特写（背面朝上展示印花）→ 3. 正面全身穿搭展示 → 4. 近景口播CTA
- 有转身（正→背）：1. 人物正面穿着口播 → 2. 产品平铺展示（可展示背面印花）→ 3. 首帧正面穿着→尾帧转身展示背面 → 4. 近景口播CTA
- 有转身（背→正）：根据产品亮点在背面还是正面灵活调整首尾帧朝向

### 家居类（床、沙发等）
1. 人物在产品旁口播引出话题 → 2. 产品全景展示 → 3. 材质/细节特写 → 4. 人物使用产品口播总结

### 护肤/美妆类
1. 人物素颜口播引出需求 → 2. 产品包装/质地展示 → 3. 使用过程/上脸效果 → 4. 口播感受+CTA

### 食品类
1. 人物口播引出场景 → 2. 产品包装/外观展示 → 3. 打开/食用特写 → 4. 口播评价+CTA

### 数码/电子类
1. 人物手持产品口播 → 2. 产品使用场景全景 → 3. 功能演示/细节特写 → 4. 口播体验+CTA

---

## 用户偏好记录
<!-- 每次使用后根据用户反馈追加，格式：- [日期] [产品类型] [偏好内容] -->
- [2026-02-02] [服装/T恤] 需要先生成白底角色参考图锁定人物面孔，再生成场景图；同一分镜先生首帧再以首帧为参考生尾帧，确保背景一致
- [2026-02-02] [通用] 视频生成模型优先使用 veo-3.1-fast-generate-preview 节省成本
- [2026-02-03] [服装类] 首帧必须正面朝镜头（不可侧身），因为Veo不传产品图，侧身会导致AI幻想图案；需提前确认是否转身展示正反面
- [2026-02-03] [通用] 多张产品图需先拼接为一张composite参考图再传入生图API；生图时通过--product-image参数传入产品原图作为reference
- [2026-02-03] [自拍视角] 描述自拍时必须用POV视角（手机摄像头视角），提示词写"POV selfie camera angle, no hands visible, no phone visible"，不能描述"手拿手机"否则会生成第三人视角
- [2026-02-03] [首尾帧动作] 首尾帧动作必须逻辑连贯，不能首帧手拿A物品、尾帧又要用同一只手做B动作，会导致矛盾
- [2026-02-03] [提示词同步] 修改图片提示词(image_prompts.json)后，必须同步修改视频提示词(video_prompts.json)，否则视频生成时会出现已删除的元素
- [2026-02-03] [音色一致性] 4段视频的音色描述必须完全相同且具体，包含：音高(如180-200Hz)、气息质感、口音、共鸣位置、语速(如3.5-4音节/秒)，不能每段用不同的Pace/Mood描述
- [2026-02-03] [通用] 输出目录使用日期+序号递增命名（如20260203_001），保留历史记录
- [2026-02-03] [通用] character_ref.png 始终重新生成，不复用旧文件，确保与当前项目人物设定匹配
